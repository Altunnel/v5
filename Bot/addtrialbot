#!/bin/bash
export TERM=xterm

# Ambil waktu expired dari argumen (default 60 menit)
pup=$1
if [ -z "$pup" ]; then
    pup=60
fi

# Info sistem
IP=$(curl -sS ipv4.icanhazip.com)
domain=$(cat /etc/xray/domain)

# Buat akun trial
Login=trial-$(</dev/urandom tr -dc a-z0-9 | head -c5)
Pass=$(</dev/urandom tr -dc a-z0-9 | head -c8)
hari="1"
iplimit="99"

# Simpan limit IP
mkdir -p /etc/kyt/limit/ssh/ip/
echo "$iplimit" > /etc/kyt/limit/ssh/ip/$Login

# Buat user dan atur masa aktif
useradd -e $(date -d "$hari days" +"%Y-%m-%d") -s /bin/false -M "$Login"
echo -e "$Pass\n$Pass\n" | passwd $Login &> /dev/null

# Output ke terminal (dengan emoji)
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ðŸš€ *SSH Trial Account*"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ðŸŒ *Host:* $domain"
echo "ðŸ‘¤ *Username:* $Login"
echo "ðŸ” *Password:* $Pass"
echo "â³ *Expired:* $pup minutes"
echo ""
echo "ðŸ§² *SSH WebSocket (No SSL):*"
echo "ðŸ”¸ 80, 7788, 8880, 2082"
echo "ðŸ”’ *SSH WebSocket (SSL):*"
echo "ðŸ”¸ 443, 8443"
echo "ðŸ§© *OpenSSH:* 80, 2222, 4444"
echo "ðŸ“¡ *UDP Custom:* 1-65535"
echo "ðŸ“¦ *OHP SSH:* 9080"
echo "ðŸ›°ï¸ *Proxy:* 3128"
echo ""
echo "ðŸ” *OpenVPN Ports:*"
echo "ðŸ”¸ TCP: 80"
echo "ðŸ”¸ UDP: 25000"
echo "ðŸ”¸ SSL: 443"
echo "ðŸ“¥ *Config:* https://$domain:81/all-ovpn.zip"
echo ""
echo "ðŸ§¾ *Payload WS (Port 80):*"
echo "GET / HTTP/1.1"
echo "Host: [host_port]"
echo "Upgrade: websocket"
echo ""
echo "ðŸ§¾ *Payload WSS (Port 443):*"
echo "GET wss://BUG/ HTTP/1.1"
echo "Host: [host]"
echo "Upgrade: websocket"
echo ""
echo "ðŸŽ‰ *Script by AgungStore*"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Hapus user otomatis setelah waktu habis
echo "userdel -f \"$Login\"" | at now + $pup minutes &> /dev/null