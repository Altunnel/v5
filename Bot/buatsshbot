#!/bin/bash

USERNAME=$1
PASSWORD=$2
DAYS=$3

if [ -z "$USERNAME" ] || [ -z "$PASSWORD" ] || [ -z "$DAYS" ]; then
    echo "‚ö†Ô∏è Penggunaan: $0 <username> <password> <durasi_hari>"
    exit 1
fi

DOMAIN=$(cat /etc/xray/domain)
[ ! -f /root/.myip ] && curl -sS ipv4.icanhazip.com > /root/.myip
IP=$(cat /root/.myip)

IP_LIMIT="3"
mkdir -p /etc/kyt/limit/ssh/ip/
echo "$IP_LIMIT" > /etc/kyt/limit/ssh/ip/$USERNAME

EXPIRY_DATE=$(date -d "$DAYS days" +"%Y-%m-%d")
useradd -e "$EXPIRY_DATE" -s /bin/false -M "$USERNAME"
echo -e "$PASSWORD\n$PASSWORD" | passwd "$USERNAME" &> /dev/null

echo "### $USERNAME $PASSWORD $EXPIRY_DATE" >> /etc/.ssh.db

# Output WhatsApp Friendly
echo ""
echo "*‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ*"
echo "*    SSH / Dropbear    *"
echo "*‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ*"
echo "*Host:* $DOMAIN"
echo "*Username:* $USERNAME"
echo "*Password:* $PASSWORD"
echo "*Expired:* $EXPIRY_DATE"
echo ""
echo "*üì° SSH WebSocket (No SSL):*"
echo "80, 2082, 8080, 8880, 2095"
echo "*üîí SSH WebSocket (SSL):*"
echo "443, 8443, 2053, 2083"
echo "*üì¶ OpenSSH Ports:*"
echo "80, 2222, 4444"
echo "*üõ°Ô∏è UDP Ports:*"
echo "1-65535"
echo ""
echo "*üì• OpenVPN Config:*"
echo "https://$DOMAIN:81/all-ovpn.zip"
echo ""
echo "*üìú Payload WebSocket Port 80:*"
echo "GET / HTTP/1.1"
echo "Host: [host_port]"
echo "Upgrade: websocket"
echo ""
echo "*üìú Payload WebSocket TLS Port 443:*"
echo "GET wss://BUG/ HTTP/1.1"
echo "Host: [host]"
echo "Upgrade: websocket"
echo ""
echo "*‚úÖ Akun aktif selama $DAYS hari*"
echo "*Terima kasih telah menggunakan script ini!*"
echo "*‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ*"

# Hapus otomatis saat expired
echo "userdel -f \"$USERNAME\"" | at now + "$DAYS" days &> /dev/null