#!/bin/bash
export TERM=xterm
touch /root/.system

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“Š  *SSH/Dropbear Active Users*"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
printf "ğŸ‘¤ %-15s ğŸ“¥ %-5s\n" "Username" "Login"
echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

# Ambil data login aktif (dari fungsi cekssh bawaan)
mulog=$(cekssh)

# Ambil daftar user dari /etc/passwd yang punya home dir
data=( $(awk -F: '$6 ~ /\/home/ {print $1}' /etc/passwd) )

for user in "${data[@]}"
do
    aktif=$(echo "$mulog" | grep -w "$user" | wc -l)

    if [[ $aktif -gt 0 ]]; then
        limit_file="/etc/kyt/limit/ssh/ip/$user"

        # Jika file limit tidak ada, isi default 1
        [[ ! -f "$limit_file" ]] && echo "1" > "$limit_file"

        iplimit=$(cat "$limit_file")

        printf "ğŸ‘¤ %-15s ğŸ”„ %-5s %s\n" "$user" "$aktif" Device
        echo "slot" >> /root/.system
    fi

    sleep 0.1
done

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ™ Terima kasih telah menggunakan script ini"
echo "ğŸ”§ Script by AgungStore"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"